<html><head>
<title>math::calculus::romberg - Tcl Math Library </title>
</head>
<! -- Generated from file 'C:/Documents and Settings/Kohlbrecher/Desktop/tcllib-1.8/modules/math/romberg.man' by tcllib/doctools with format 'html'
   -->
<! -- Copyright &copy; 2004 Kevin B. Kenny &lt;kennykb@acm.org&gt;. All rights reserved. Redistribution permitted under the terms of the Open Publication License &lt;http://www.opencontent.org/openpub/&gt;
   -->
<! -- CVS: $Id: romberg.html,v 1.1 2006/05/02 12:32:19 kohlbrecher Exp $ math::calculus::romberg.n
   -->

<body>
<h1> math::calculus::romberg(n) 0.6 math &quot;Tcl Math Library&quot;</h1>
<h2><a name="name">NAME</a></h2>
<p>
<p> math::calculus::romberg - Romberg integration





<h2><a name="table_of_contents">TABLE OF CONTENTS</a></h2>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#table_of_contents">TABLE OF CONTENTS</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#synopsis">SYNOPSIS</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#description">DESCRIPTION</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#procedures">PROCEDURES</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#parameters">PARAMETERS</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#options">OPTIONS</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#description">DESCRIPTION</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#improper_integrals">IMPROPER INTEGRALS</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#other_changes_of_variable">OTHER CHANGES OF VARIABLE</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#see_also">SEE ALSO</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#copyright">COPYRIGHT</a><br>
<h2><a name="synopsis">SYNOPSIS</a></h2>
<p>
package require <b>Tcl 8.2</b><br>
package require <b>math::calculus 0.6</b><br>
<br><table border=1 width=100% cellspacing=0 cellpadding=0><tr            bgcolor=lightyellow><td bgcolor=lightyellow><table 0 width=100% cellspacing=0 cellpadding=0><tr valign=top ><td ><a href="#1"><b class='cmd'>::math::calculus::romberg</b> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a></td></tr>
<tr valign=top ><td ><a href="#2"><b class='cmd'>::math::calculus::romberg_infinity</b> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a></td></tr>
<tr valign=top ><td ><a href="#3"><b class='cmd'>::math::calculus::romberg_sqrtSingLower</b> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a></td></tr>
<tr valign=top ><td ><a href="#4"><b class='cmd'>::math::calculus::romberg_sqrtSingUpper</b> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a></td></tr>
<tr valign=top ><td ><a href="#5"><b class='cmd'>::math::calculus::romberg_powerLawLower</b> <i class='arg'>gamma</i> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a></td></tr>
<tr valign=top ><td ><a href="#6"><b class='cmd'>::math::calculus::romberg_powerLawUpper</b> <i class='arg'>gamma</i> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a></td></tr>
<tr valign=top ><td ><a href="#7"><b class='cmd'>::math::calculus::romberg_expLower</b> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a></td></tr>
<tr valign=top ><td ><a href="#8"><b class='cmd'>::math::calculus::romberg_expUpper</b> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a></td></tr>
</table></td></tr></table>
<h2><a name="description">DESCRIPTION</a></h2>
<p>
<p>
The <b class='cmd'>romberg</b> procedures in the <b class='cmd'>math::calculus</b> package
perform numerical integration of a function of one variable.  They
are intended to be of &quot;production quality&quot; in that they are robust,
precise, and reasonably efficient in terms of the number of function
evaluations.
<h2><a name="procedures">PROCEDURES</a></h2>
<p>

The following procedures are available for Romberg integration:

<dl>
<dt><a name="1"><b class='cmd'>::math::calculus::romberg</b> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a><dd>


Integrates an analytic function over a given interval.

<br><br>
<dt><a name="2"><b class='cmd'>::math::calculus::romberg_infinity</b> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a><dd>


Integrates an analytic function over a half-infinite interval.

<br><br>
<dt><a name="3"><b class='cmd'>::math::calculus::romberg_sqrtSingLower</b> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a><dd>


Integrates a function that is expected to be analytic over an interval
except for the presence of an inverse square root singularity at the
lower limit.

<br><br>
<dt><a name="4"><b class='cmd'>::math::calculus::romberg_sqrtSingUpper</b> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a><dd>


Integrates a function that is expected to be analytic over an interval
except for the presence of an inverse square root singularity at the
upper limit.

<br><br>
<dt><a name="5"><b class='cmd'>::math::calculus::romberg_powerLawLower</b> <i class='arg'>gamma</i> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a><dd>


Integrates a function that is expected to be analytic over an interval
except for the presence of a power law singularity at the
lower limit.

<br><br>
<dt><a name="6"><b class='cmd'>::math::calculus::romberg_powerLawUpper</b> <i class='arg'>gamma</i> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a><dd>


Integrates a function that is expected to be analytic over an interval
except for the presence of a power law singularity at the
upper limit.

<br><br>
<dt><a name="7"><b class='cmd'>::math::calculus::romberg_expLower</b> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a><dd>


Integrates an exponentially growing function; the lower limit of the
region of integration may be arbitrarily large and negative.

<br><br>
<dt><a name="8"><b class='cmd'>::math::calculus::romberg_expUpper</b> <i class='arg'>f</i> <i class='arg'>a</i> <i class='arg'>b</i> ?<i class='arg'>-option value</i>...?</a><dd>


Integrates an exponentially decaying function; the upper limit of the
region of integration may be arbitrarily large.

</dl>

<h2><a name="parameters">PARAMETERS</a></h2>
<p>

<dl>

<dt><i class='arg'>f</i><dd>

Function to integrate.  Must be expressed as a single Tcl command,
to which will be appended a single argument, specifically, the
abscissa at which the function is to be evaluated. The first word
of the command will be processed with <b class='cmd'>namespace which</b> in the
caller's scope prior to any evaluation. Given this processing, the
command may local to the calling namespace rather than needing to be
global.

<br><br>
<dt><i class='arg'>a</i><dd>

Lower limit of the region of integration.

<br><br>
<dt><i class='arg'>b</i><dd>

Upper limit of the region of integration.  For the
<b class='cmd'>romberg_sqrtSingLower</b>, <b class='cmd'>romberg_sqrtSingUpper</b>,
<b class='cmd'>romberg_powerLawLower</b>, <b class='cmd'>romberg_powerLawUpper</b>,
<b class='cmd'>romberg_expLower</b>, and <b class='cmd'>romberg_expUpper</b> procedures,
the lower limit must be strictly less than the upper.  For
the other procedures, the limits may appear in either order.

<br><br>
<dt><i class='arg'>gamma</i><dd>

Power to use for a power law singularity; see section
<a href="#improper_integrals">IMPROPER INTEGRALS</a> for details.

</dl>

<h2><a name="options">OPTIONS</a></h2>
<p>

<dl>

<dt><strong>-abserror</strong> <i class='arg'>epsilon</i><dd>

Requests that the integration machinery proceed at most until
the estimated absolute error of the integral is less than
<i class='arg'>epsilon</i>. The error may be seriously over- or underestimated
if the function (or any of its derivatives) contains singularities;
see section <a href="#improper_integrals">IMPROPER INTEGRALS</a> for details. Default
is 1.0e-08.

<br><br>
<dt><strong>-relerror</strong> <i class='arg'>epsilon</i><dd>

Requests that the integration machinery proceed at most until
the estimated relative error of the integral is less than
<i class='arg'>epsilon</i>. The error may be seriously over- or underestimated
if the function (or any of its derivatives) contains singularities;
see section <a href="#improper_integrals">IMPROPER INTEGRALS</a> for details.  Default is
1.0e-06.

<br><br>
<dt><strong>-maxiter</strong> <i class='arg'>m</i><dd>

Requests that integration terminate after at most <i class='arg'>n</i> triplings of
the number of evaluations performed.  In other words, given <i class='arg'>n</i>
for <strong>-maxiter</strong>, the integration machinery will make at most
3**<i class='arg'>n</i> evaluations of the function.  Default is 14, corresponding
to a limit approximately 4.8 million evaluations. (Well-behaved
functions will seldom require more than a few hundred evaluations.)

<br><br>
<dt><strong>-degree</strong> <i class='arg'>d</i><dd>

Requests that an extrapolating polynomial of degree <i class='arg'>d</i> be used
in Romberg integration; see section <a href="#description">DESCRIPTION</a> for
details. Default is 4.  Can be at most <i class='arg'>m</i>-1.

</dl>

<h2><a name="description">DESCRIPTION</a></h2>
<p>

The <b class='cmd'>romberg</b> procedure performs Romberg integration using
the modified midpoint rule. Romberg integration is an iterative
process.  At the first step, the function is evaluated at the
midpoint of the region of integration, and the value is multiplied by
the width of the interval for the coarsest possible estimate.
At the second step, the interval is divided into three parts,
and the function is evaluated at the midpoint of each part; the
sum of the values is multiplied by three.  At the third step,
nine parts are used, at the fourth twenty-seven, and so on,
tripling the number of subdivisions at each step.

<p>

Once the interval has been divided at least <i class='arg'>d</i> times,
a polynomial is fitted to the integrals estimated in the last
<i class='arg'>d</i>+1 divisions.  The integrals are considered to be a
function of the square of the width of the subintervals
(any good numerical analysis text will discuss this process
under &quot;Romberg integration&quot;).  The polynomial is extrapolated
to a step size of zero, computing a value for the integral and
an estimate of the error.

<p>

This process will be well-behaved only if the function is analytic
over the region of integration; there may be removable singularities
at either end of the region provided that the limit of the function
(and of all its derivatives) exists as the ends are approached.
Thus, <b class='cmd'>romberg</b> may be used to integrate a function like
f(x)=sin(x)/x over an interval beginning or ending at zero.

<p>

Note that <b class='cmd'>romberg</b> will either fail to converge or else return
incorrect error estimates if the function, or any of its derivatives,
has a singularity anywhere in the region of integration (except for
the case mentioned above).  Care must be used, therefore, in
integrating a function like 1/(1-x**2) to avoid the places
where the derivative is singular.

<h2><a name="improper_integrals">IMPROPER INTEGRALS</a></h2>
<p>

Romberg integration is also useful for integrating functions over
half-infinite intervals or functions that have singularities.
The trick is to make a change of variable to eliminate the
singularity, and to put the singularity at one end or the other
of the region of integration.  The <b class='cmd'>math::calculus</b> package
supplies a number of <b class='cmd'>romberg</b> procedures to deal with the
commoner cases.

<dl>

<dt><b class='cmd'>romberg_infinity</b><dd>

Integrates a function over a half-infinite interval; either
<i class='arg'>a</i> or <i class='arg'>b</i> may be infinite.  <i class='arg'>a</i> and <i class='arg'>b</i> must be
of the same sign; if you need to integrate across the axis,
say, from a negative value to positive infinity,
use <b class='cmd'>romberg</b> to integrate from the negative
value to a small positive value, and then <b class='cmd'>romberg_infinity</b>
to integrate from the positive value to positive infinity.  The
<b class='cmd'>romberg_infinity</b> procedure works by making the change of
variable u=1/x, so that the integral from a to b of f(x) is
evaluated as the integral from 1/a to 1/b of f(1/u)/u**2.

<br><br>
<dt><b class='cmd'>romberg_powerLawLower</b> and <b class='cmd'>romberg_powerLawUpper</b><dd>

Integrate a function that has an integrable power law singularity
at either the lower or upper bound of the region of integration
(or has a derivative with a power law singularity there).
These procedures take a first parameter, <i class='arg'>gamma</i>, which gives
the power law.  The function or its first derivative are presumed to diverge as
(x-<i class='arg'>a</i>)**(-<i class='arg'>gamma</i>) or (<i class='arg'>b</i>-x)**(-<i class='arg'>gamma</i>).  <i class='arg'>gamma</i>
must be greater than zero and less than 1.

<br><br>

These procedures are useful not only in integrating functions
that go to infinity at one end of the region of integration, but
also functions whose derivatives do not exist at the end of
the region.  For instance, integrating f(x)=pow(x,0.25) with the
origin as one end of the region will result in the <b class='cmd'>romberg</b>
procedure greatly underestimating the error in the integral.
The problem can be fixed by observing that the first derivative
of f(x), f'(x)=x**(-3/4)/4, goes to infinity at the origin.  Integrating
using <b class='cmd'>romberg_powerLawLower</b> with <i class='arg'>gamma</i> set to 0.75
gives much more orderly convergence.

<br><br>

These procedures operate by making the change of variable
u=(x-a)**(1-gamma) (<b class='cmd'>romberg_powerLawLower</b>) or
u=(b-x)**(1-gamma) (<b class='cmd'>romberg_powerLawUpper</b>).

<br><br>

To summarize the meaning of gamma:

<br><br>
<ul>
<li>
If f(x) ~ x**(-a) (0 &lt; a &lt; 1), use gamma = a
<br><br>
<li>
If f'(x) ~ x**(-b) (0 &lt; b &lt; 1), use gamma = b
</ul>

<dt><b class='cmd'>romberg_sqrtSingLower</b> and <b class='cmd'>romberg_sqrtSingUpper</b><dd>

These procedures behave identically to <b class='cmd'>romberg_powerLawLower</b> and
<b class='cmd'>romberg_powerLawUpper</b> for the common case of <i class='arg'>gamma</i>=0.5;
that is, they integrate a function with an inverse square root
singularity at one end of the interval.  They have a simpler
implementation involving square roots rather than arbitrary powers.

<br><br>
<dt><b class='cmd'>romberg_expLower</b> and <b class='cmd'>romberg_expUpper</b><dd>

These procedures are for integrating a function that grows or
decreases exponentially over a half-infinite interval.
<b class='cmd'>romberg_expLower</b> handles exponentially growing functions, and
allows the lower limit of integration to be an arbitrarily large
negative number.  <b class='cmd'>romberg_expUpper</b> handles exponentially
decaying functions and allows the upper limit of integration to
be an arbitrary large positive number.  The functions make the
change of variable u=exp(-x) and u=exp(x) respectively.

</dl>

<h2><a name="other_changes_of_variable">OTHER CHANGES OF VARIABLE</a></h2>
<p>

If you need an improper integral other than the ones listed here,
a change of variable can be written in very few lines of Tcl.
Because the Tcl coding that does it is somewhat arcane,
we offer a worked example here.

<p>

Let's say that the function that we want to integrate is
f(x)=exp(x)/sqrt(1-x*x) (not a very natural
function, but a good example), and we want to integrate
it over the interval (-1,1).  The denominator falls to zero
at both ends of the interval. We wish to make a change of variable
from x to u
so that dx/sqrt(1-x**2) maps to du.  Choosing x=sin(u), we can
find that dx=cos(u)*du, and sqrt(1-x**2)=cos(u).  The integral
from a to b of f(x) is the integral from asin(a) to asin(b)
of f(sin(u))*cos(u).

<p>

We can make a function <b class='cmd'>g</b> that accepts an arbitrary function
<b class='cmd'>f</b> and the parameter u, and computes this new integrand.

<p><table><tr><td bgcolor=black>&nbsp;</td><td><pre class='sample'>
proc g { f u } {
    set x [expr { sin($u) }]
    set cmd $f; lappend cmd $x; set y [eval $cmd]
    return [expr { $y / cos($u) }]
}
</pre></td></tr></table></p>

Now integrating <b class='cmd'>f</b> from <i class='arg'>a</i> to <i class='arg'>b</i> is the same
as integrating <b class='cmd'>g</b> from <i class='arg'>asin(a)</i> to <i class='arg'>asin(b)</i>.
It's a little tricky to get <b class='cmd'>f</b> consistently evaluated in
the caller's scope; the following procedure does it.

<p><table><tr><td bgcolor=black>&nbsp;</td><td><pre class='sample'>
proc romberg_sine { f a b args } {
    set f [lreplace $f 0 0 [uplevel 1 [list namespace which [lindex $f 0]]]]
    set f [list g $f]
    return [eval [linsert $args 0 romberg $f [expr { asin($a) }] [expr { asin($b) }]]]
}
</pre></td></tr></table></p>

This <b class='cmd'>romberg_sine</b> procedure will do any function with
sqrt(1-x*x) in the denominator. Our sample function is
f(x)=exp(x)/sqrt(1-x*x):

<p><table><tr><td bgcolor=black>&nbsp;</td><td><pre class='sample'>
proc f { x } {
    expr { exp($x) / sqrt( 1. - $x*$x ) }
}
</pre></td></tr></table></p>

Integrating it is a matter of applying <b class='cmd'>romberg_sine</b>
as we would any of the other <b class='cmd'>romberg</b> procedures:

<p><table><tr><td bgcolor=black>&nbsp;</td><td><pre class='sample'>
foreach { value error } [romberg_sine f -1.0 1.0] break
puts [format &quot;integral is %.6g +/- %.6g&quot; $value $error]

integral is 3.97746 +/- 2.3557e-010
</pre></td></tr></table></p>




<h2><a name="see_also">SEE ALSO</a></h2>
<p>
math::calculus, math::interpolate
<h2><a name="copyright">COPYRIGHT</a></h2>
<p>
Copyright &copy; 2004 Kevin B. Kenny &lt;kennykb@acm.org&gt;. All rights reserved. Redistribution permitted under the terms of the Open Publication License &lt;http://www.opencontent.org/openpub/&gt;<br>
</body></html>
